---
layout: layouts/base.njk
pagination:
  data: source_summaries
  size: 1
  alias: summary
permalink: "/summaries/{{ summary.source_id }}/"
eleventyComputed:
  title: "{{ (sources | getSourceById(summary.source_id)).title }} Summary"
---
{% set source = sources | getSourceById(summary.source_id) %}

<h1>{{ source.title }}</h1>
<p class="summary-intro">A human-readable summary curated by the agentic feed.</p>

<section class="summary-card">
  <p><strong>Summary:</strong> {{ summary.summary }}</p>
  {%- if summary.long_summary %}
    <p>{{ summary.long_summary }}</p>
  {%- endif %}
  <div class="summary-meta">
    {%- for tag in summary.tags %}
      <a class="tag-pill" href="{{ ('/topics/tag/' ~ (tag | slugifyTerm) ~ '/') | url }}">{{ tag }}</a>
    {%- endfor %}
    {%- for topic in summary.topics %}
      <a class="tag-pill" href="{{ ('/topics/topic/' ~ (topic | slugifyTerm) ~ '/') | url }}">{{ topic }}</a>
    {%- endfor %}
    {%- for category in summary.categories %}
      <a class="tag-pill" href="{{ ('/topics/category/' ~ (category | slugifyTerm) ~ '/') | url }}">{{ category }}</a>
    {%- endfor %}
  </div>
  <div class="summary-links">
    <a href="{{ '/sources/' | url }}">Back to sources</a>
    {%- if source.url %}
      <a href="{{ source.url }}">Original source</a>
    {%- endif %}
  </div>
</section>

{% set summaryTerms = [] %}
{% if summary.tags %}
  {% set summaryTerms = summaryTerms.concat(summary.tags) %}
{% endif %}
{% if summary.topics %}
  {% set summaryTerms = summaryTerms.concat(summary.topics) %}
{% endif %}
{% if summary.categories %}
  {% set summaryTerms = summaryTerms.concat(summary.categories) %}
{% endif %}

{% if summaryTerms.length %}
  {% set relatedArticles = [] %}
  {%- for article in collections.articles %}
    {%- set matched = false %}
    {%- for blockId in article.data.blocks %}
      {%- set block = collections.argumentBlocks | getBlockById(blockId) %}
      {%- if block %}
        {%- set blockTerms = [] %}
        {%- if block.data.tags %}{%- set blockTerms = blockTerms.concat(block.data.tags) %}{%- endif %}
        {%- if block.data.topics %}{%- set blockTerms = blockTerms.concat(block.data.topics) %}{%- endif %}
        {%- if block.data.categories %}{%- set blockTerms = blockTerms.concat(block.data.categories) %}{%- endif %}
        {%- for term in summaryTerms %}
          {%- if term in blockTerms %}
            {%- set matched = true %}
          {%- endif %}
        {%- endfor %}
      {%- endif %}
    {%- endfor %}
    {%- if matched %}
      {%- set relatedArticles = relatedArticles.concat([article]) %}
    {%- endif %}
  {%- endfor %}

  {% if relatedArticles.length %}
    <section>
      <h2>Related articles</h2>
      <ul class="article-list">
        {%- for article in relatedArticles %}
          <li>
            <a href="{{ article.url | url }}">{{ article.data.title }}</a>
            {% if article.data.summary %}
              <p class="article-summary">{{ article.data.summary }}</p>
            {% endif %}
          </li>
        {%- endfor %}
      </ul>
    </section>
  {% endif %}
{% endif %}

<section class="citation-section">
  <h3>Source details</h3>
  <ol class="citation-list">
    <li class="citation-item">
      <strong>Author/Publisher:</strong>
      {{ source.author or source.publisher or source.repository or 'Unknown' }}<br>
      <strong>Published:</strong> {{ source.published or 'n.d.' }}<br>
      <strong>Title:</strong> {{ source.title }}<br>
      {%- if source.journal %}<strong>Container:</strong> {{ source.journal }}<br>{% endif -%}
      {%- if source.publisher and not source.journal %}<strong>Container:</strong> {{ source.publisher }}<br>{% endif -%}
      {%- if source.repository and not source.journal and not source.publisher %}<strong>Container:</strong> {{ source.repository }}<br>{% endif -%}
      {%- if source.accessed %}<strong>Accessed:</strong> {{ source.accessed }}<br>{% endif -%}
      {%- if source.url %}<strong>URL:</strong> <a href="{{ source.url }}">{{ source.url }}</a>{% endif -%}
    </li>
  </ol>
</section>
