---
layout: layouts/base.njk
---
<article class="article">
  <header class="article-header">
    <h1>{{ title }}</h1>
  </header>

  {% if intro %}
  <section class="article-intro">
    {{ intro | safe }}
  </section>
  {% endif %}

  {% set articleSourceIds = blocks | collectBlockSourceIds(collections.argumentBlocks, citations) %}
  {% set articlePeople = people | getPeopleBySourceIds(articleSourceIds) %}
  {% if articlePeople.length %}
  <section class="article-people">
    <h2>People referenced</h2>
    <ul class="meta-list">
      {%- for person in articlePeople %}
        <li><a href="{{ ('/people/' ~ person.id ~ '/') | url }}">{{ person.name }}</a></li>
      {%- endfor %}
    </ul>
  </section>
  {% endif %}

  {% set articleCitationIds = blocks | collectBlockCitations(collections.argumentBlocks) %}

  <section class="article-blocks">
    {% for blockId in blocks %}
      {% set block = collections.argumentBlocks | getBlockById(blockId) %}
      {% if block %}
        {% include "components/block.njk" %}
      {% else %}
        {% set conceptBlock = collections.concepts | getConceptById(blockId) %}
        {% if conceptBlock %}
          <section class="block concept-block" id="{{ conceptBlock.data.id }}">
            <h2>{{ conceptBlock.data.title }}</h2>
            <div class="block-content">
              {{ conceptBlock.templateContent | safe }}
            </div>
          </section>
        {% else %}
          <!-- Block not found: {{ blockId }} -->
        {% endif %}
      {% endif %}
    {% endfor %}
  </section>

  {% if reading_tags %}
    {% include "components/extended-reading.njk" %}
  {% endif %}

  {% if outro %}
  <section class="article-outro">
    {{ outro | safe }}
  </section>
  {% endif %}

  {% if articleCitationIds and articleCitationIds.length %}
    {{ articleCitationIds | renderCitationSection(citations, sources, source_summaries) | safe }}
  {% endif %}
</article>
